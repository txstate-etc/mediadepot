# mediadepot
Media download server

A hyper based server with CAS authentication that allows the user to download the media content they created from the You Star project.

## Non-Authenticated API points:
* `/health - GET/HEAD` This path lets us know that the server is running.
* `/resources/<rest_of_file_path> - GET/HEAD` This path is where css and images are stored and served up.
* `/logout - GET` This path is always available since user may be authenticated but not have authorization as not all users have an entry in the vcms directory. When the user gets directed here their session cookie will be removed and they will get redirected to the CAS logout application.

## Authenticated API points:
* `/ - GET` This path is where the user will go to get their application and see what media files they created via the YouStar program.
* `/library/<rest_of_file_path> - GET/HEAD/DELETE` This path is used to manage the users files. They may check size (HEAD), download (GET), or remove (DELETE) them. Their id they used to authenticate and the path to the library directory will get prepended to this path to find the file requested.

## Environment variables:
* `ADDRESS` This is the address and port that the server will bind. The default is `127.0.0.1:8443`
* `MASTERKEY` This is a base64 encoded 32 bit key used to sign the session cookies. If one is not provided then it will randomly be generated by the application. This should be set to maintain sessions between restarts of the application.
* `ROOTDIR` This is the directory where the `/resources` and `/vcms/<id>/library` directories are stored.  The default is `/var/lib/www`
* `DOMAIN` This is the protocol, name of the server, and port that the user sees. An example would be `https://mediadepot.its.txstate.edu:8443` domain. The application will not start without this field being defined.
* `CASURL` This is the address of the CAS server. An example would be `https://login.its.txstate.edu`, however, note that some universities require the cas path added to the end like `https://login.its.txstate.edu/cas` as their tomcat application is not running under the ROOT path but under rather the cas directory.

## ROOTDIR subdirectories:
* `/resources` This is where the images, css, and other files that support the user interface reside.
* `/private` This is where the SSL certificates are stored. Note that the application expects to use SSL and will not start without them.
* `/vcms` This is where all the created video content will be placed. The filesystem is broken up into user id's where their content will be placed under a library directory. Each video file will reside within it's own directory under the library directory, which will contain not only the video itself, but also a json file describing the video and a thumbnails directory containing images of different spots within the video.

## TODOs:
* Setup with docker (17.05+) multi-staged builds.
* Design templates to fill in with user content.
* Add Content-Disposition header force browsers to download the video content rather then play them.
