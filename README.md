# mediadepot
Media download server

A hyper based server with CAS authentication that allows the user to download the media content they created from the You Star project.

## Non-Authenticated API points:
* `/health - [GET|HEAD]` This path lets us know that the server is running.
* `/static/<rest_of_file_path> - [GET|HEAD]` This path is where css and images are stored and served up.
* `/logout - [GET]` This path is always available since user may be authenticated but not have authorization as not all users have an entry in the vcms directory. When the user gets directed here their session cookie will be removed and they will get redirected to the CAS logout application.

## Authenticated API points:
* `/ - [GET]` This path is where the user will go to get their application and see what media files they created via the YouStar program.
* `/library - [GET|<HEAD>|DELETE]` This path is used by an admin to view the list of user files. The request is authorized with a Json Web Token relayed via Authorization Bearer http header or session cookie setup via CAS login process. The reaponse will always be of "application/json" Content Type.
* `/library/<rest_of_file_path> - [GET|HEAD|DELETE]` This path is used bay a CAS authenticated user or JWT admin to manage the their files. Their id used to authenticate is prepended to the library path to find the file requested. NOTE: DELETE method may never be implemented depending on required features.

## Environment variables:
* `ADDRESS` This is the address and port that the server will bind. The default is `127.0.0.1:8443`
* `MASTERKEY` This is a base64 encoded 32 byte key used to sign the session cookies after CAS authentication. If one is not provided then it will randomly be generated by the application. This should be set to maintain sessions between restarts of the application. Example of generating master key: `openssl rand -base64 32`
* `JWTKEY` This is a base64 encoded 64 byte key used to sign JSON Web Tokens (JWT) for adminstrative requests via the `/admin` API. There is no default set for this and the service will terminate if one is not assigned. Example of generating JWT key: `openssl rand -base64 64`
* `ROOTDIR` This is the directory where the `/resources` and `/vcms/<id>/library` directories are stored.  The default is `/var/lib/www`
* `DOMAIN` This is the protocol, name of the server, and port that the user sees. An example would be `https://mediadepot.its.txstate.edu:8443` domain. The application will not start without this field being defined.
* `CASURL` This is the address of the CAS server. An example would be `https://login.example.edu`, however, note that some universities require the cas path added to the end like `https://login.example.edu/cas` as their tomcat application is not running under the ROOT path but under rather the cas directory.
* `SSL_CERT_FILE` /etc/ssl/certs/ca-certificates.crt
* `SSL_CERT_DIR` /etc/ssl/certs
* `CERTS_PUBLIC` This is the location of the public cert for mediadepot `DOMAIN`
* `CERTS_PRIVATE` This is the location of the private key for the mediadepot `DOMAIN`
* `RUST_LOG` This is used to define the logging level. Example of info level logging: "media_depot=info"

## ROOTDIR subdirectories:
* `/static` This is where the images, css, and other files that support the user interface reside.
* `/vcms` This is where all the created video content will reside. The filesystem is broken up into user id's. All user video content will be placed within a library directory under the associated user directory.

## docker examples:
```
docker build --target deploy -t ${TXSTATE_REGISTRY}/mediadepot:2.0.0 .
docker run --rm --env-file ~+/www/env.txt --read-only -v ~+/www:/var/lib/www:ro -p 127.0.0.1:8443:443 --name mediadepot ${TXSTATE_REGISTRY}/mediadepot:2.0.0
```
